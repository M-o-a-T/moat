#include "fakebus/crc11.h"
#include <stdio.h>

/*
 * This code implements a lookup-based CRC for polynomial 0xAC9A.
 *
 * 11-bit CRC tables are not part of this code, they're generated on the fly.
 */

// table generated by running "moatbus/crc.py"

static const u_int16_t table11[] = {
0, 1975, 1129, 990, 981, 1122, 1980, 11, 1962, 29, 963, 1140, 1151, 968, 22, 1953, 1107, 996, 58, 1933, 1926, 49, 1007, 1112, 1017, 1102, 1936, 39, 44, 1947, 1093, 1010, 929, 1046, 1992, 127, 116, 1987, 1053, 938, 1035, 956, 98, 2005, 2014, 105, 951, 1024, 2034, 69, 923, 1068, 1063, 912, 78, 2041, 88, 2031, 1073, 902, 909, 1082, 2020, 83, 1858, 245, 811, 1180, 1175, 800, 254, 1865, 232, 1887, 1153, 822, 829, 1162, 1876, 227, 785, 1190, 1912, 207, 196, 1907, 1197, 794, 1211, 780, 210, 1893, 1902, 217, 775, 1200, 1251, 852, 138, 1853, 1846, 129, 863, 1256, 841, 1278, 1824, 151, 156, 1835, 1269, 834, 176, 1799, 1241, 878, 869, 1234, 1804, 187, 1818, 173, 883, 1220, 1231, 888, 166, 1809, 1411, 564, 490, 1629, 1622, 481, 575, 1416, 553, 1438, 1600, 503, 508, 1611, 1429, 546, 464, 1639, 1465, 526, 517, 1458, 1644, 475, 1658, 461, 531, 1444, 1455, 536, 454, 1649, 1570, 405, 587, 1532, 1527, 576, 414, 1577, 392, 1599, 1505, 598, 605, 1514, 1588, 387, 625, 1478, 1560, 431, 420, 1555, 1485, 634, 1499, 620, 434, 1541, 1550, 441, 615, 1488, 705, 1398, 1704, 287, 276, 1699, 1405, 714, 1387, 732, 258, 1717, 1726, 265, 727, 1376, 1682, 293, 763, 1356, 1351, 752, 302, 1689, 312, 1679, 1361, 742, 749, 1370, 1668, 307, 352, 1751, 1289, 702, 693, 1282, 1756, 363, 1738, 381, 675, 1300, 1311, 680, 374, 1729, 1331, 644, 346, 1773, 1766, 337, 655, 1336, 665, 1326, 1776, 327, 332, 1787, 1317, 658
};

//CRC(0x571,11,8)

u_int16_t crc11_update(u_int16_t crc, u_int8_t byte)
{
    crc = table11[(byte ^ crc) & 0xFF] ^ (crc>>8);
    return crc;
}
